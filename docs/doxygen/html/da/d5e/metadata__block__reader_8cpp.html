<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Macrium Image File Layout: mrimg_file_layout/src/libs/file_reader/metadata_block_reader.cpp File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../clipboard.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../ReflectX_small.png"/></td>
  <td id="projectalign">
   <div id="projectname">Macrium Image File Layout
   </div>
   <div id="projectbrief">Source Documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('da/d5e/metadata__block__reader_8cpp.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">metadata_block_reader.cpp File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>This file contains the implementation of the Macrium Reflect X backup file reader library, specifically for reading and interpreting metadata blocks.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;pch.h&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d2/d64/file__operations_8h_source.html">..\file_operations\file_operations.h</a>&quot;</code><br />
<code>#include &quot;.\zstd\zstd.h&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d6/ddf/encryption_8h_source.html">..\encryption\encryption.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d0/de7/file__reader_8h_source.html">file_reader.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d2/d97/metadata__block__reader_8h_source.html">metadata_block_reader.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d9/dd3/metadataheader_8h_source.html">metadataheader.h</a>&quot;</code><br />
</div>
<p><a href="../../da/d5e/metadata__block__reader_8cpp_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a311afb05facbc1e590fdfbff70a779d0" id="r_a311afb05facbc1e590fdfbff70a779d0"><td class="memItemLeft" align="right" valign="top">std::unique_ptr&lt; unsigned char[]&gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a311afb05facbc1e590fdfbff70a779d0">readBlock</a> (const <a class="el" href="../../d6/d6d/structfile__structs_1_1file_layout.html">file_structs::fileLayout</a> &amp;backupLayout, <a class="el" href="../../dc/da1/struct_metadata_block_header.html">MetadataBlockHeader</a> &amp;Header, std::fstream *fileHandle)</td></tr>
<tr class="memdesc:a311afb05facbc1e590fdfbff70a779d0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reads a metadata block from a Macrium Reflect X backup file.  <br /></td></tr>
<tr class="separator:a311afb05facbc1e590fdfbff70a779d0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3fb7456d8ef45e0314a17597b1238ea8" id="r_a3fb7456d8ef45e0314a17597b1238ea8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a3fb7456d8ef45e0314a17597b1238ea8">readDiskMetadata</a> (const <a class="el" href="../../d6/d6d/structfile__structs_1_1file_layout.html">file_structs::fileLayout</a> &amp;backupLayout, std::fstream *fileHandle, <a class="el" href="../../d4/dcc/structfile__structs_1_1_disk_1_1_disk_layout.html">file_structs::Disk::DiskLayout</a> &amp;Disk)</td></tr>
<tr class="memdesc:a3fb7456d8ef45e0314a17597b1238ea8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reads disk metadata from a Macrium Reflect X backup file.  <br /></td></tr>
<tr class="separator:a3fb7456d8ef45e0314a17597b1238ea8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2b213e2ba57a092f2e6a01633ef20b43" id="r_a2b213e2ba57a092f2e6a01633ef20b43"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a2b213e2ba57a092f2e6a01633ef20b43">readFileMetadataData</a> (const <a class="el" href="../../d6/d6d/structfile__structs_1_1file_layout.html">file_structs::fileLayout</a> &amp;backupLayout, std::fstream *fileHandle, std::string &amp;strJSON)</td></tr>
<tr class="separator:a2b213e2ba57a092f2e6a01633ef20b43"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a91e376695e77fb5543a33db84ba36274" id="r_a91e376695e77fb5543a33db84ba36274"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a91e376695e77fb5543a33db84ba36274">skipMetadata</a> (std::fstream *fileHandle)</td></tr>
<tr class="separator:a91e376695e77fb5543a33db84ba36274"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This file contains the implementation of the Macrium Reflect X backup file reader library, specifically for reading and interpreting metadata blocks. </p>
<p>This library provides a set of cross-platform functions for reading metadata blocks from a Macrium Reflect X backup file. It handles various aspects such as reading the header offset and magic data, reading metadata blocks, and reading the JSON data from the backup file. It also checks for encryption and compression flags, decompresses data if necessary, decrypts data when required, and computes and verifies the MD5 hash of the data.</p>
<p>The functions in this file are implemented in a way that they can be used on different operating systems without requiring system-specific implementations. This makes the code more maintainable and scalable, and allows it to be used in a wider range of environments. </p>

<p class="definition">Definition in file <a class="el" href="../../da/d5e/metadata__block__reader_8cpp_source.html">metadata_block_reader.cpp</a>.</p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a311afb05facbc1e590fdfbff70a779d0" name="a311afb05facbc1e590fdfbff70a779d0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a311afb05facbc1e590fdfbff70a779d0">&#9670;&#160;</a></span>readBlock()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::unique_ptr&lt; unsigned char[]&gt; readBlock </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d6/d6d/structfile__structs_1_1file_layout.html">file_structs::fileLayout</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>backupLayout</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../dc/da1/struct_metadata_block_header.html">MetadataBlockHeader</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>Header</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::fstream *</td>          <td class="paramname"><span class="paramname"><em>fileHandle</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reads a metadata block from a Macrium Reflect X backup file. </p>
<p>The size of the block is determined by <code>Header.BlockLength</code>. If the block is compressed, it is decompressed using Zstandard (ZSTD) decompression. If the block is encrypted, the function currently asserts false as encryption is not yet implemented.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Header</td><td>A reference to a <code><a class="el" href="../../dc/da1/struct_metadata_block_header.html">MetadataBlockHeader</a></code> object that contains the block's metadata. </td></tr>
    <tr><td class="paramname">hFile</td><td>A handle to the Macrium Reflect X backup file from which to read the block. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A <code>std::unique_ptr</code> to an array of unsigned chars that contains the block data. If the block length is 0, or if an error occurs during reading or decompression, it returns <code>nullptr</code>. </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../da/d5e/metadata__block__reader_8cpp_source.html#l00045">45</a> of file <a class="el" href="../../da/d5e/metadata__block__reader_8cpp_source.html">metadata_block_reader.cpp</a>.</p>

</div>
</div>
<a id="a3fb7456d8ef45e0314a17597b1238ea8" name="a3fb7456d8ef45e0314a17597b1238ea8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3fb7456d8ef45e0314a17597b1238ea8">&#9670;&#160;</a></span>readDiskMetadata()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void readDiskMetadata </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d6/d6d/structfile__structs_1_1file_layout.html">file_structs::fileLayout</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>backupLayout</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::fstream *</td>          <td class="paramname"><span class="paramname"><em>fileHandle</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d4/dcc/structfile__structs_1_1_disk_1_1_disk_layout.html">file_structs::Disk::DiskLayout</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>Disk</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reads disk metadata from a Macrium Reflect X backup file. </p>
<p>This function reads the metadata block by block until it finds the TRACK_0 and EXT_PAR_TABLE blocks. It then reads these blocks and assigns their contents to the <code>Disk</code> object.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fileHandle</td><td>A handle to the Macrium Reflect X backup file from which to read the metadata. </td></tr>
    <tr><td class="paramname">Disk</td><td>A reference to a DiskLayout object where the disk metadata will be stored. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../da/d5e/metadata__block__reader_8cpp_source.html#l00116">116</a> of file <a class="el" href="../../da/d5e/metadata__block__reader_8cpp_source.html">metadata_block_reader.cpp</a>.</p>

</div>
</div>
<a id="a2b213e2ba57a092f2e6a01633ef20b43" name="a2b213e2ba57a092f2e6a01633ef20b43"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2b213e2ba57a092f2e6a01633ef20b43">&#9670;&#160;</a></span>readFileMetadataData()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void readFileMetadataData </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d6/d6d/structfile__structs_1_1file_layout.html">file_structs::fileLayout</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>backupLayout</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::fstream *</td>          <td class="paramname"><span class="paramname"><em>fileHandle</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string &amp;</td>          <td class="paramname"><span class="paramname"><em>strJSON</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Reads file metadata from a Macrium Reflect X backup file.</p>
<p>This function reads the metadata block by block until it finds the JSON_HEADER block. It then reads this block and assigns its contents to the <code>strJSON</code> string.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fileHandle</td><td>A handle to the Macrium Reflect X backup file from which to read the metadata. </td></tr>
    <tr><td class="paramname">strJSON</td><td>A reference to a string where the JSON metadata will be stored. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../da/d5e/metadata__block__reader_8cpp_source.html#l00197">197</a> of file <a class="el" href="../../da/d5e/metadata__block__reader_8cpp_source.html">metadata_block_reader.cpp</a>.</p>

</div>
</div>
<a id="a91e376695e77fb5543a33db84ba36274" name="a91e376695e77fb5543a33db84ba36274"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a91e376695e77fb5543a33db84ba36274">&#9670;&#160;</a></span>skipMetadata()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void skipMetadata </td>
          <td>(</td>
          <td class="paramtype">std::fstream *</td>          <td class="paramname"><span class="paramname"><em>fileHandle</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Skips metadata blocks in a Macrium Reflect X backup file.</p>
<p>This function iterates over the metadata blocks and advances the file pointer, but it does not read any block data.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fileHandle</td><td>A handle to the Macrium Reflect X backup file from which to skip the metadata. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../da/d5e/metadata__block__reader_8cpp_source.html#l00238">238</a> of file <a class="el" href="../../da/d5e/metadata__block__reader_8cpp_source.html">metadata_block_reader.cpp</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../dir_88e100402737e4fa918e4aa5a7dba644.html">mrimg_file_layout</a></li><li class="navelem"><a class="el" href="../../dir_34285ecb0ee8fd6ba963d985ce135e66.html">src</a></li><li class="navelem"><a class="el" href="../../dir_89ba79a4af698e9a0f72a28273c38cea.html">libs</a></li><li class="navelem"><a class="el" href="../../dir_96f40ed729f7c458ab202dbc89a67627.html">file_reader</a></li><li class="navelem"><a class="el" href="../../da/d5e/metadata__block__reader_8cpp.html">metadata_block_reader.cpp</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
