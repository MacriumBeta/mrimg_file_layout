<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Macrium Image File Layout: mrimg_file_layout/src/libs/file_reader/backup_set.cpp File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../clipboard.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../ReflectX_small.png"/></td>
  <td id="projectalign">
   <div id="projectname">Macrium Image File Layout
   </div>
   <div id="projectbrief">Source Documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('d0/d13/backup__set_8cpp.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">backup_set.cpp File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>This file contains the implementation of the Macrium Reflect X backup set handling.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;pch.h&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d2/d64/file__operations_8h_source.html">..\file_operations\file_operations.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d7/d6b/file__structs_8h_source.html">file_structs.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d0/de7/file__reader_8h_source.html">file_reader.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d7/d2a/backup__set_8h_source.html">backup_set.h</a>&quot;</code><br />
</div>
<p><a href="../../d0/d13/backup__set_8cpp_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ae6a047c57c9d31db143776340784fbe3" id="r_ae6a047c57c9d31db143776340784fbe3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ae6a047c57c9d31db143776340784fbe3">mapDeltaToFullIndex</a> (<a class="el" href="../../d1/df5/structfile__structs_1_1_partition_1_1_partition_layout.html">file_structs::Partition::PartitionLayout</a> &amp;partitionToRestore, const <a class="el" href="../../d1/df5/structfile__structs_1_1_partition_1_1_partition_layout.html">file_structs::Partition::PartitionLayout</a> &amp;partitionToMap)</td></tr>
<tr class="memdesc:ae6a047c57c9d31db143776340784fbe3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Maps the delta data blocks to the corresponding full data blocks.  <br /></td></tr>
<tr class="separator:ae6a047c57c9d31db143776340784fbe3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8ec98ef3498b5e2e6f0bcc2c0877f463" id="r_a8ec98ef3498b5e2e6f0bcc2c0877f463"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8ec98ef3498b5e2e6f0bcc2c0877f463">getFullIndexBeforeDelta</a> (const <a class="el" href="../../d7/d2a/backup__set_8h.html#a3bd0dc659cbbb4e51f5c36d25234acd9">BackupSetFileLayouts</a> &amp;backupSetFileLayouts)</td></tr>
<tr class="memdesc:a8ec98ef3498b5e2e6f0bcc2c0877f463"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieves the index of the last full backup before any delta backups.  <br /></td></tr>
<tr class="separator:a8ec98ef3498b5e2e6f0bcc2c0877f463"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad6b7285f2356b1950ce71429ba70eb92" id="r_ad6b7285f2356b1950ce71429ba70eb92"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad6b7285f2356b1950ce71429ba70eb92">buildIndex</a> (<a class="el" href="../../d2/dec/struct_backup_set.html">BackupSet</a> &amp;backupSet, const <a class="el" href="../../d7/d2a/backup__set_8h.html#a3bd0dc659cbbb4e51f5c36d25234acd9">BackupSetFileLayouts</a> &amp;backupSetFileLayouts)</td></tr>
<tr class="memdesc:ad6b7285f2356b1950ce71429ba70eb92"><td class="mdescLeft">&#160;</td><td class="mdescRight">Builds an index for the backup set.  <br /></td></tr>
<tr class="separator:ad6b7285f2356b1950ce71429ba70eb92"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a439af5cc2f70119dff00f4c4fe3df58a" id="r_a439af5cc2f70119dff00f4c4fe3df58a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a439af5cc2f70119dff00f4c4fe3df58a">addBackupFileToSet</a> (<a class="el" href="../../d2/dec/struct_backup_set.html">BackupSet</a> &amp;backupSet, const std::filesystem::path &amp;filePath, const <a class="el" href="../../d6/d6d/structfile__structs_1_1file_layout.html">file_structs::fileLayout</a> &amp;backupFile, <a class="el" href="../../d7/d2a/backup__set_8h.html#a3bd0dc659cbbb4e51f5c36d25234acd9">BackupSetFileLayouts</a> &amp;backupSetFileLayouts)</td></tr>
<tr class="memdesc:a439af5cc2f70119dff00f4c4fe3df58a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Adds a backup file to the backup set.  <br /></td></tr>
<tr class="separator:a439af5cc2f70119dff00f4c4fe3df58a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9e2eced73b465a0fff4f1d4935a3e432" id="r_a9e2eced73b465a0fff4f1d4935a3e432"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a9e2eced73b465a0fff4f1d4935a3e432">createBackupSet</a> (<a class="el" href="../../d2/dec/struct_backup_set.html">BackupSet</a> &amp;backupSet, const std::wstring &amp;filePath, const std::string &amp;password, const std::string &amp;imageId)</td></tr>
<tr class="memdesc:a9e2eced73b465a0fff4f1d4935a3e432"><td class="mdescLeft">&#160;</td><td class="mdescRight">Creates a backup set from a given backup file.  <br /></td></tr>
<tr class="separator:a9e2eced73b465a0fff4f1d4935a3e432"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This file contains the implementation of the Macrium Reflect X backup set handling. </p>
<p>This library provides a set of cross-platform functions for managing and manipulating backup sets. It handles various aspects such as creating a backup set from a given backup file, adding a backup file to a set, building an index for the backup set, and retrieving specific backup files from the set. </p>

<p class="definition">Definition in file <a class="el" href="../../d0/d13/backup__set_8cpp_source.html">backup_set.cpp</a>.</p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a439af5cc2f70119dff00f4c4fe3df58a" name="a439af5cc2f70119dff00f4c4fe3df58a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a439af5cc2f70119dff00f4c4fe3df58a">&#9670;&#160;</a></span>addBackupFileToSet()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void addBackupFileToSet </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d2/dec/struct_backup_set.html">BackupSet</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>backupSet</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::filesystem::path &amp;</td>          <td class="paramname"><span class="paramname"><em>filePath</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d6/d6d/structfile__structs_1_1file_layout.html">file_structs::fileLayout</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>backupFile</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d7/d2a/backup__set_8h.html#a3bd0dc659cbbb4e51f5c36d25234acd9">BackupSetFileLayouts</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>backupSetFileLayouts</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Adds a backup file to the backup set. </p>
<p>This function creates a BackupFileAndHandle object for the backup file and adds it to the backup set. It also adds the file number and file handle to the indexHandleMap in the backupSet, which is used to quickly find the file handle for a given file number. The function also handles file merges due to consolidation. This enables merged files to reference the file handle of the consolidated file.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">backupSet</td><td>The <a class="el" href="../../d2/dec/struct_backup_set.html" title="Represents a set of backup files and their associated handles.">BackupSet</a> object to add the backup file to. </td></tr>
    <tr><td class="paramname">filePath</td><td>The path to the backup file. </td></tr>
    <tr><td class="paramname">backupFile</td><td>The file layout of the backup file. </td></tr>
    <tr><td class="paramname">backupSetFileLayouts</td><td>The file layouts for the backup set. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d0/d13/backup__set_8cpp_source.html#l00172">172</a> of file <a class="el" href="../../d0/d13/backup__set_8cpp_source.html">backup_set.cpp</a>.</p>

</div>
</div>
<a id="ad6b7285f2356b1950ce71429ba70eb92" name="ad6b7285f2356b1950ce71429ba70eb92"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad6b7285f2356b1950ce71429ba70eb92">&#9670;&#160;</a></span>buildIndex()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void buildIndex </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d2/dec/struct_backup_set.html">BackupSet</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>backupSet</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d7/d2a/backup__set_8h.html#a3bd0dc659cbbb4e51f5c36d25234acd9">BackupSetFileLayouts</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>backupSetFileLayouts</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Builds an index for the backup set. </p>
<p>This function builds an index for the backup set to facilitate quick access to the backup files. If the backup set contains a delta index, the function builds a full index by mapping the delta data blocks to the corresponding full data blocks.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">backupSet</td><td>The <a class="el" href="../../d2/dec/struct_backup_set.html" title="Represents a set of backup files and their associated handles.">BackupSet</a> to build an index for. </td></tr>
    <tr><td class="paramname">backupSetFileLayouts</td><td>The file layouts for the backup set. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d0/d13/backup__set_8cpp_source.html#l00122">122</a> of file <a class="el" href="../../d0/d13/backup__set_8cpp_source.html">backup_set.cpp</a>.</p>

</div>
</div>
<a id="a9e2eced73b465a0fff4f1d4935a3e432" name="a9e2eced73b465a0fff4f1d4935a3e432"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9e2eced73b465a0fff4f1d4935a3e432">&#9670;&#160;</a></span>createBackupSet()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void createBackupSet </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d2/dec/struct_backup_set.html">BackupSet</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>backupSet</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::wstring &amp;</td>          <td class="paramname"><span class="paramname"><em>filePath</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;</td>          <td class="paramname"><span class="paramname"><em>password</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;</td>          <td class="paramname"><span class="paramname"><em>imageId</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Creates a backup set from a given backup file. </p>
<p>This function populates a <a class="el" href="../../d2/dec/struct_backup_set.html" title="Represents a set of backup files and their associated handles.">BackupSet</a> object with backup files from a given file path. It then builds an index for the backup set to facilitate quick access to the backup files.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">backupSet</td><td>The <a class="el" href="../../d2/dec/struct_backup_set.html" title="Represents a set of backup files and their associated handles.">BackupSet</a> object to populate. </td></tr>
    <tr><td class="paramname">filePath</td><td>The path to the backup file. </td></tr>
    <tr><td class="paramname">password</td><td>The password for the backup file. </td></tr>
    <tr><td class="paramname">imageId</td><td>The image ID for the backup file. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d0/d13/backup__set_8cpp_source.html#l00206">206</a> of file <a class="el" href="../../d0/d13/backup__set_8cpp_source.html">backup_set.cpp</a>.</p>

</div>
</div>
<a id="a8ec98ef3498b5e2e6f0bcc2c0877f463" name="a8ec98ef3498b5e2e6f0bcc2c0877f463"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8ec98ef3498b5e2e6f0bcc2c0877f463">&#9670;&#160;</a></span>getFullIndexBeforeDelta()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t getFullIndexBeforeDelta </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d7/d2a/backup__set_8h.html#a3bd0dc659cbbb4e51f5c36d25234acd9">BackupSetFileLayouts</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>backupSetFileLayouts</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Retrieves the index of the last full backup before any delta backups. </p>
<p>This function iterates over the backup set and returns the index of the last full backup (not delta) before any delta backups. If no such backup is found, an exception is thrown.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">backupSet</td><td>The <a class="el" href="../../d2/dec/struct_backup_set.html" title="Represents a set of backup files and their associated handles.">BackupSet</a> to search. </td></tr>
    <tr><td class="paramname">backupSetFileLayouts</td><td>The file layouts for the backup set. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The index of the last full backup before any delta backups. </dd></dl>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname">std::runtime_error</td><td>if no full backup is found before any delta backups. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d0/d13/backup__set_8cpp_source.html#l00054">54</a> of file <a class="el" href="../../d0/d13/backup__set_8cpp_source.html">backup_set.cpp</a>.</p>

</div>
</div>
<a id="ae6a047c57c9d31db143776340784fbe3" name="ae6a047c57c9d31db143776340784fbe3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae6a047c57c9d31db143776340784fbe3">&#9670;&#160;</a></span>mapDeltaToFullIndex()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mapDeltaToFullIndex </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d1/df5/structfile__structs_1_1_partition_1_1_partition_layout.html">file_structs::Partition::PartitionLayout</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>partitionToRestore</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d1/df5/structfile__structs_1_1_partition_1_1_partition_layout.html">file_structs::Partition::PartitionLayout</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>partitionToMap</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Maps the delta data blocks to the corresponding full data blocks. </p>
<p>This function is used when restoring a backup. It iterates over each delta data block in the delta partition layout, and maps it to the corresponding data block in the full partition layout using the index in the delta data block.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">partitionToRestore</td><td>- The partition being restored. </td></tr>
    <tr><td class="paramname">partitionToMap</td><td>- The previous delta index to map into partitionToRestore</td></tr>
  </table>
  </dd>
</dl>
<p>Note: partitionToRestore has already had the full index copied into it. This function will map the delta index into it. </p>

<p class="definition">Definition at line <a class="el" href="../../d0/d13/backup__set_8cpp_source.html#l00030">30</a> of file <a class="el" href="../../d0/d13/backup__set_8cpp_source.html">backup_set.cpp</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../dir_88e100402737e4fa918e4aa5a7dba644.html">mrimg_file_layout</a></li><li class="navelem"><a class="el" href="../../dir_34285ecb0ee8fd6ba963d985ce135e66.html">src</a></li><li class="navelem"><a class="el" href="../../dir_89ba79a4af698e9a0f72a28273c38cea.html">libs</a></li><li class="navelem"><a class="el" href="../../dir_96f40ed729f7c458ab202dbc89a67627.html">file_reader</a></li><li class="navelem"><a class="el" href="../../d0/d13/backup__set_8cpp.html">backup_set.cpp</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
